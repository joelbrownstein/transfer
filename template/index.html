<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <title>{{ title }}</title>
    <link rel="stylesheet" type="text/css" media="screen" href="../resources/css/bootstrap-2.3.2.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="../resources/css/bootstrap-responsive-2.3.2.min.css" />
    <script type="text/javascript" src="../resources/js/jquery-1.10.2.js"></script>
</head>
<body>
    <div class="container-fluid">
        {% set survey = "SDSS-V" if generation==5 else "SDSS-IV" if generation==4 else "SDSS" %}
        {% set alt_observatory = "apo" if ( observatory=='lco' and mode=='mos') else "lco" if observatory=='apo' else None %}
        {% set alt_mode = "lvm" if ( mode=='mos' and observatory=='lco' ) else "mos" if ( mode=='lvm' and observatory=='lco' ) else None %}
        {% set alt_observatory_link = "https://data.sdss5.org/sas/sdsswork/data/staging/%s/log/%s/" % ( alt_observatory, mode ) if ( generation==5 and alt_observatory ) else None %}
        {% set alt_mode_link = "https://data.sdss5.org/sas/sdsswork/data/staging/%s/log/%s/" % ( observatory, alt_mode ) if ( generation==5 and alt_mode ) else None %}
        {% set unam_verify_link = "https://data.sdss5.org/sas/sdsswork/data/staging/unam/verify/lvm/lco/" if mode=='lvm' else None %}
        <div class="masthead">
            <h1>{{survey}}</h1>
            <h2>{{ title }}</h2>
            <p>If you are looking for:<ul>
                {% if alt_observatory and alt_observatory_link%}<li>the {{ alt_observatory }} data transfer status page, please see <a href="{{alt_observatory_link}}">{{alt_observatory_link}}</a></li>{% endif %}
                {% if alt_mode and alt_mode_link %}<li>the {{ alt_mode }} data transfer status page, please see <a href="{{alt_mode_link}}">{{alt_mode_link}}</a></li>{% endif %}
                {% if unam_verify_link %}<li>the utah-unam verify status page, please see <a href="{{ unam_verify_link }}?C=M&O=D">{{unam_verify_link}}</a></li>{% endif %}
            </ul></p>
        </div>
        <div class="row-fluid">
            <div class="span12">
                <table class="table table-striped table-condensed">
                    <caption>MJD Status</caption>
                    <thead>
                        <tr><th>MJD</th>{% for stage in stages %}<th>{{ stage | upper }}</th>{% endfor %}</tr>
                    </thead>
                    <tbody>
                        {% for history in histories -%}
                        <tr>
                            <td>{%- if history.logfile -%}<a href="../../reports/{{mode}}/{{ history.logfile }}" title="{{ history.logfile }}">{{ history.MJD }}</a>{% else %}{{ history.MJD }}{% endif %}</td>
                            {% for stage in stages -%}{% set history_stage = history[stage] -%}{% set stage = history_stage.stage -%}{% set status = history_stage.status -%}{% set status = 'on sas' if status == 'success' and stage not in  ['backup', 'mirror'] else 'nersc hpss' if status == 'success' and stage == 'backup' else 'unam filemon' if ( mode == 'lvm' and status == 'success' and history.MJD < 60421) else 'on sas' if status == 'success' and history.MJD > 59882 else 'nersc' if status == 'success' else status %}{% set color = colors[status] -%}
                            <td class="{{ color }}"><abbr title="{{ history_stage.stamp }}">{% if status %}{{ status | upper }}{% else %}--{% endif %}</abbr></td>
                            {%- endfor %}
                        </tr>
                        {%- endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <footer class="footer hidden-tablet hidden-phone">
            <p class="muted">Modified: {{ modified.strftime('%Y-%m-%d %H:%M') }} UTC.</p>
        </footer>
    </div>
</body>
</html>
