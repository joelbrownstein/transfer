#!/bin/sh
# Sandbox GUIDER -> GCAM #

## APO ##
observatory=apo
guider=$SANDBOX_DIR/guider/$observatory
# 484 mjds in [59140, 59958]
## DR17 has mjd up to 59163 ##
for mjd in `ls -1 /uufs/chpc.utah.edu/common/home/sdss50/dr17/$observatory/gcam/ | grep ^591`; do echo $mjd; done
mjds=( 59140 59142 59143 59146 59147 59148 59149 59154 59155 59156 59157 59158 59159 59160 59161 59162 59163 )
for mjd in `ls -1 $guider`; do echo $mjd; done > ~/transfer/sdss50/guider/$observatory/mjds-all.txt #minus above mjds
mjds=( 59164 59165 59166 59167 59168 59169 59179 59186 59187 59188 59189 59190 59191 59192 59193 59194 59195 59196 59197 59198 59199 59200 59201 59202 59203 59204 59205 59206 59207 59208 59209 59210 59211 59212 59213 59214 59215 59216 59217 59218 59219 59220 59221 59222 59223 59224 59225 59226 59227 59228 59229 59230 59231 59232 59233 59234 59235 59236 59237 59238 59239 59240 59241 59242 59243 59244 59245 59246 59247 59248 59249 59250 59251 59252 59253 59254 59255 59256 59257 59258 59259 59260 59261 59262 59263 59264 59265 59266 59267 59268 59269 59270 59271 59272 59273 59274 59275 59276 59277 59278 59279 59280 59281 59282 59283 59284 59285 59286 59287 59288 59289 59290 59291 59292 59293 59294 59295 59296 59297 59298 59299 59300 59301 59302 59303 59304 59305 59306 59307 59308 59309 59310 59311 59312 59313 59314 59315 59316 59317 59318 59319 59320 59321 59322 59323 59324 59325 59326 59327 59328 59329 59330 59334 59335 59336 59337 59338 59339 59340 59341 59342 59343 59344 59345 59346 59347 59348 59349 59350 59351 59352 59353 59354 59355 59356 59357 59358 59359 59360 59361 59362 59363 59364 59365 59366 59367 59368 59369 59370 59371 59372 59373 59374 59375 59376 59378 59379 59380 59381 59382 59383 59384 59385 59386 59387 59388 59389 59390 59391 59392 59393 59564 59565 59566 59568 59569 59571 59572 59575 59577 59578 59583 59584 59585 59586 59587 59588 59589 59591 59592 59594 59595 59596 59597 59600 59601 59602 59604 59605 59606 59607 59608 59609 59611 59615 59616 59618 59619 59620 59621 59622 59623 59624 59625 59626 59629 59630 59631 59632 59633 59635 59636 59637 59638 59640 59641 59643 59644 59645 59646 59647 59648 59651 59652 59653 59654 59655 59656 59657 59658 59659 59662 59663 59664 59665 59666 59669 59670 59671 59672 59673 59674 59675 59676 59677 59678 59679 59680 59681 59683 59684 59686 59687 59689 59690 59691 59692 59693 59694 59695 59696 59697 59698 59699 59700 59701 59702 59704 59705 59706 59707 59708 59709 59710 59711 59712 59713 59714 59715 59716 59717 59718 59719 59720 59721 59722 59723 59724 59725 59726 59727 59728 59729 59730 59731 59733 59734 59736 59737 59738 59740 59741 59742 59744 59745 59746 59753 59755 59760 59761 59762 59763 59764 59787 59789 59793 59794 59797 59798 59799 59801 59804 59805 59806 59807 59817 59818 59820 59821 59825 59826 59827 59828 59829 59830 59831 59832 59833 59834 59835 59838 59839 59840 59844 59845 59846 59847 59864 59865 59866 59871 59872 59873 59874 59878 59879 59881 59882 59883 59884 59885 59886 59888 59889 59890 59891 59892 59893 59894 59895 59896 59897 59898 59899 59900 59901 59902 59904 59905 59906 59907 59910 59911 59912 59913 59914 59915 59916 59922 59923 59924 59925 59928 59929 59930 59931 59933 59934 59935 59936 59937 59938 59939 59940 59941 59943 59945 59949 59950 59951 59952 59953 59954 59955 59956 59957 59958 )
touch ~/transfer/sdss50/guider/$observatory/mjds-sdsswork.txt
for mjd in "${mjds[@]}"; do
    nlines=`rsync -avcn $guider/$mjd/ $GCAM_DATA_N/$mjd/ | wc -l`
    if [ $nlines -gt 5 ]; then echo $mjd >> ~/transfer/sdss50/guider/$observatory/mjds-sdsswork.txt; fi
done



## LCO ##
observatory=lco
guider=$SANDBOX_DIR/guider/$observatory
# 134 mjds in [59808, 59967]
## DR17 has mjd up to 59235 (no overlap) ##
# mjd_dr17: None
for mjd in `ls -1 $guider`; do echo $mjd; done > ~/transfer/sdss50/guider/$observatory/mjds-all.txt

mjds=( 59808 59809 59810 59811 59812 59813 59814 59816 59817 59818 59819 59820 59821 59822 59823 59824 59825 59826 59827 59829 59830 59831 59832 59833 59834 59835 59836 59837 59838 59840 59841 59843 59844 59845 59849 59850 59853 59854 59855 59858 59859 59860 59861 59864 59865 59866 59867 59871 59872 59873 59874 59875 59876 59877 59878 59879 59880 59881 59882 59883 59884 59885 59886 59887 59888 59889 59890 59891 59893 59897 59898 59900 59901 59902 59903 59904 59905 59906 59907 59908 59909 59910 59911 59912 59913 59915 59916 59917 59918 59920 59921 59922 59923 59925 59926 59927 59928 59929 59930 59931 59932 59933 59934 59935 59936 59937 59940 59941 59942 59943 59944 59945 59946 59947 59948 59949 59950 59951 59952 59953 59954 59955 59956 59957 59958 59959 59960 59961 59962 59963 59964 59965 59966 59967 )
touch ~/transfer/sdss50/guider/$observatory/mjds-sdsswork.txt
for mjd in "${mjds[@]}"; do
    nlines=`rsync -avcn $guider/$mjd/ $GCAM_DATA_S/$mjd/ | wc -l`
    if [ $nlines -gt 5 ]; then echo $mjd >> ~/transfer/sdss50/guider/$observatory/mjds-sdsswork.txt; fi
done
mjds=( 59808 59809 59810 59811 59814 59816 59817 59818 59819 59820 59821 59822 59824 59825 59826 59827 59830 59831 59832 59833 59834 59837 59838 59840 59841 59843 59845 59850 59853 59854 59947 59948 )

rsync -avcn $guider/$mjd/ $GCAM_DATA_S/$mjd/



observatory=apo
guider=$SANDBOX_DIR/guider/$observatory
mjds=( 59140 59142 59143 59146 59147 59148 59149 59154 59155 59156 59157 59158 59159 59160 59161 59162 59163 59164 59165 59166 59167 59168 59169 59179 59186 59187 59188 59189 59190 59191 59192 59193 59194 59195 59196 59197 59198 59199 59200 59201 59202 59203 59204 59205 59206 59207 59208 59209 59210 59211 59212 59213 59214 59215 59216 59217 59218 59219 59220 59221 59222 59223 59224 59225 59226 59227 59228 59229 59230 59231 59232 59233 59234 59235 59236 59237 59238 59239 59240 59241 59242 59243 59244 59245 59246 59247 59248 59249 59250 59251 59252 59253 59254 59255 59256 59257 59258 59259 59260 59261 59262 59263 59264 59265 59266 59267 59268 59269 59270 59271 59272 59273 59274 59275 59276 59277 59278 59279 59280 59281 59282 59283 59284 59285 59286 59287 59288 59289 59290 59291 59292 59293 59294 59295 59296 59297 59298 59299 59300 59301 59302 59303 59304 59305 59306 59307 59308 59309 59310 59311 59312 59313 59314 59315 59316 59317 59318 59319 59320 59321 59322 59323 59324 59325 59326 59327 59328 59329 59330 59334 59335 59336 59337 59338 59339 59340 59341 59342 59343 59344 59345 59346 59347 59348 59349 59350 59351 59352 59353 59354 59355 59356 59357 59358 59359 59360 59361 59362 59363 59364 59365 59366 59367 59368 59369 59370 59371 59372 59373 59374 59375 59376 59378 59379 59380 59381 59382 59383 59384 59385 59386 59387 59388 59389 59390 59391 59392 59393 59569 59817 59818 59820 59821 59825 59826 59827 59828 59829 59830 59831 59832 59833 59834 59835 59838 59839 59840 59844 59845 59846 59847 59864 59865 59866 59890 )
sync=~sdssadmin/transfer/sdss50/guider/$observatory/sync
for mjd in "${mjds[@]}"; do
    echo $mjd
    rsync -avc $guider/$mjd/ $GCAM_DATA_N/$mjd/ > $sync/rsync-$mjd.o
done

observatory=lco
guider=$SANDBOX_DIR/guider/$observatory
mjds=( 59808 59809 59810 59811 59814 59816 59817 59818 59819 59820 59821 59822 59824 59825 59826 59827 59830 59831 59832 59833 59834 59837 59838 59840 59841 59843 59845 59850 59853 59854 59947 59948 )
sync=~sdssadmin/transfer/sdss50/guider/$observatory/sync
for mjd in "${mjds[@]}"; do
    echo $mjd
    rsync -avc $guider/$mjd/ $GCAM_DATA_S/$mjd/ > $sync/rsync-$mjd.o
done


Summary

 For LCO:
I found 134 mjds in [59808, 59967] in $SANDBOX_DIR/guider/lco/ (listed in ~apogee/sync_guider/lco/mjds-all.txt)
Of these only 32 mjds needed sync according to checksum comparison via rsync -avc (listed in ~apogee/sync_guider/lco/mjds-sdsswork.txt)
I synced each of the 32 out-of-sync mjds to $GCAM_DATA_S (rsync output in ~apogee/sync_guider/lco/sync)

For APO:
I found 484 mjds in [59140, 59958] in $SANDBOX_DIR/guider/apo/ (listed in ~apogee/sync_guider/apo/mjds-all.txt)
Of these only 255 mjds needed sync according to checksum comparison via rsync -avc (listed in ~apogee/sync_guider/apo/mjds-sdsswork.txt)
I synced each of the 255 out-of-sync mjds to $GCAM_DATA_S (rsync output in ~apogee/sync_guider/apo/sync)
